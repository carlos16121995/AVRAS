
@{
    ViewData["Title"] = "AdicionarProduto";
    Layout = "~/Views/Shared/_Layout_Painel.cshtml";
}

@section script{ 
    <script>
        function validaNome() {
            var nome = $("#nome").val();
            if ((nome != "") && (nome.length > 3)) {
                $("#nome").focus();
                $("#nome").addClass("is-valid");
                if ($("#nome").hasClass("is-invalid"))
                    $("#nome").removeClass("is-invalid");
                return true;
            }
            else {
                $("#nome").focus();
                $("#nome").addClass("is-invalid");
                if ($("#nome").hasClass("is-valid"))
                    $("#nome").removeClass("is-valid");

                return false;
            }
        }
        function formatarMoeda(elemento) {
            var valor = elemento.value;

            valor = valor + '';
            valor = parseInt(valor.replace(/[\D]+/g, ''));
            valor = valor + '';
            valor = valor.replace(/([0-9]{2})$/g, ",$1");

            if (valor.length > 6) {
                valor = valor.replace(/([0-9]{3}),([0-9]{2}$)/g, ".$1,$2");
            }
            elemento.value = valor;
            if (valor == "NaN" || valor == 0) {
                $("#valor").focus();
                $("#valor").addClass("is-invalid");
                if ($("#valor").hasClass("is-valid"))
                    $("#valor").removeClass("is-valid");
                return false;
            }
            else {
                $("#valor").focus();
                $("#valor").addClass("is-valid");
                if ($("#valor").hasClass("is-invalid"))
                    $("#valor").removeClass("is-invalid");
                return true;
            }
        }
        function somenteNumeros(num) {
            var er = /[^0-9.]/;
            er.lastIndex = 0;
            var campo = num;
            if (er.test(campo.value)) {
                campo.value = "";
            }
            if (num.value == "") {
                $("#numero").focus();
                $("#numero").addClass("is-invalid");
                if ($("#numero").hasClass("is-valid"))
                    $("#numero").removeClass("is-valid");
                return false;
            }
            if (num.value == 0) {
                $("#numero").focus();
                $("#numero").addClass("is-invalid");
                if ($("#numero").hasClass("is-valid"))
                    $("#numero").removeClass("is-valid");
                return false;
            }
            if (isNaN(num.value)) {
                $("#numero").focus();
                $("#numero").addClass("is-invalid");
                if ($("#numero").hasClass("is-valid"))
                    $("#numero").removeClass("is-valid");
                return false;
            }
            else {
                $("#numero").focus();
                $("#numero").addClass("is-valid");
                if ($("#numero").hasClass("is-invalid"))
                    $("#numero").removeClass("is-invalid");
                return true;
            }
        }
        function Limpar() {

            $("#id").val("");
            $("#id").removeClass("is-invalid");
            $("#id").removeClass("is-valid");

            $("#nome").val("");
            $("#nome").removeClass("is-invalid");
            $("#nome").removeClass("is-valid");

            $("#quantidade").val("");
            $("#quantidade").removeClass("is-invalid");
            $("#quantidade").removeClass("is-valid");

            $("#minimo").val("");
            $("#minimo").removeClass("is-invalid");
            $("#minimo").removeClass("is-valid");

            $("#compra").val("");
            $("#compra").removeClass("is-invalid");
            $("#compra").removeClass("is-valid");

            $("#venda").val("");
            $("#venda").removeClass("is-invalid");
            $("#venda").removeClass("is-valid");
        }
        function Finalizar() {
            var valida = true;
            if (validaNome() == false) {
                valida = false;
            }
            if (validaData() == false) {
                valida = false;
            }
            if (formatarMoeda() == false) {
                valida = false;
            }
            var aux = $("#numero");
            if (somenteNumeros(aux[0]) == false) {
                valida = false;
            }

            if (valida == true) {
                var formData = new FormData();
                var id = $("#id").val();
                if (id == "") {
                    id = 0;
                }
                else {
                    id = $("#id").val();
                }
                var imagem = $("#imagem");
                formData.append("Id", id);
                formData.append("Nome", $("#nome").val());
                formData.append("Valor", $("#valor").val());
                formData.append("Parcelas", $("#numero").val());
                formData.append("DataVencimento", $("#data-vencimento").val());
                //formData.append("Imagem", imagem.files[1]);
                //formData.append("Descricao", $("descricao").val());
                //formData.append("Alt", $("alt").val());

                $.ajax({
                    type: 'POST',
                    url: '/Patrocinador/Gravar',
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if (response.retorno == 1) {


                            window.location.href = "/Patrocinador/Lista";
                        }
                        if (response == 99) {
                            $('#Erro').modal('show');
                            $('#titulo').html("Ops...");
                            $('#corpo').html("A duração do contrato deve ser de no mínimo 1 mês.");
                        }
                        else {
                            $('#Erro').modal('show');
                            $('#titulo').html("Ops...");
                            $('#corpo').html("Parece que houve um problema com algum campo preenchido. Verifique se os dados foram preenchidos corretamente.");


                        }
                    },
                    error: function (error) {
                        $('#Erro').modal('show');
                        $('#titulo').html("Ops... Ocorreu um erro!");
                        $('#corpo').html("Tente novamente.");
                    }
                });
            }

        }
    </script>
}

<div class="container my-5 ">
    <div class="row ">
        <div class="col-lg-1 col-12" align="center">
            <span> <img src="~/images/estoque.png" class="logo" alt="Imagem de 1 pessoa ao lado de uma pilha de caixas de papelão" /></span>
        </div>
        <div class="col-lg-6 col-12 align-self-center float-none">
            <h2> Cadastro de Produtos </h2><span id="carregando"></span>
        </div>
    </div>

</div>
<div class="container d-block">
    <input type="hidden" id="id" value="" />
    <div class="row">
        <div class="form-group col-12">
            <label for="nome">Nome:</label>
            <input type="text" class="form-control" id="nome" onchange="validaNome();" value="" required>
            <div class="valid-feedback" id="valida-nome-valid">
            </div>
            <div class="invalid-feedback" id="valida-nome">
                Nome inválido!
            </div>
        </div>
    </div>
    <div class="row">
        <div class="form-group col-12">
            <label for="nome">Tipo:</label>
            <select class="form-control" id="tipo"></select>
        </div>
    </div>
    <div class="row">
        <div class="form-group col-12 col-lg-6">
            <label for="quantidade">Quantidade em estoque:</label>
            <input type="text" class="form-control" pattern="(\b[0-9]\b)/g" onkeyup="somenteNumeros(this);" id="quantidade" value="" required>
            <div class="valid-feedback" id="valida-quantidade-valid">
            </div>
            <div class="invalid-feedback" id="valida-quantidade">
                Quantidade inválida!
            </div>
        </div>
        <div class="form-group col-12 col-lg-6">
            <label for="minimo">Estoque Mínimo</label>
            <input type="text" class="form-control" pattern="(\b[0-9]\b)/g" onkeyup="somenteNumeros(this);" id="minimo" value="" required>
            <div class="valid-feedback" id="valida-minimo-valid">
            </div>
            <div class="invalid-feedback" id="valida-minimo">
                Quantidade inválida!
            </div>
        </div>
    </div>
    <div class="row">
        <div class="form-group col-12 col-lg-6">
            <label for="compra">Valor de compra:</label>
            <input type="text" pattern="(\b[0-9]\b)/g" onkeyup="formatarMoeda(this);" class="form-control" id="compra" value="" required>
            <div class="valid-feedback" id="valida-compra-valid">
            </div>
            <div class="invalid-feedback" id="valida-compra">
                Valor inválido!
            </div>
        </div>
        <div class="form-group col-12 col-lg-6">
            <label for="venda">Valor de venda:</label>
            <input type="text" pattern="(\b[0-9]\b)/g" onkeyup="formatarMoeda(this);" class="form-control" id="venda" value="" required>
            <div class="valid-feedback" id="valida-venda-valid">
            </div>
            <div class="invalid-feedback" id="valida-venda">
                Venda inválido!
            </div>
        </div>
    </div>
    <button class="btn btn-dark float-left my-3 " onclick="javascript: Limpar();" type="button">Limpar</button>
    <button class="btn btn-dark float-right my-3 " onclick="javascript: usuario.Gravar();" type="button">Gravar</button>
</div>
