
@{
    ViewData["Title"] = "Lista";
    Layout = "~/Views/Shared/_Layout_Painel.cshtml";
}
@section script {
    <script>
        $(document).ready(function () {
            $.getJSON("/Usuario/BuscarUsuarios", {tipo:1}, function (data) {
                PreencherTabela(data);
                
            });
        });
        function SelectBuscar() {
            let tipo = $("#busca").val();
            if (tipo != 0) {
                $.getJSON('/Usuario/BuscarUsuarios', {tipo: tipo}, function (result) {
                    if (result != "" && result != null) {
                        PreencherTabela(result);
                    }
                    else {
                        txt = "";
                        $("#tbody").html("");
                        txt = "<tr><th>Nada Encontrado...</th></tr>";
                        $("#tbody").html(txt);
                    }
                });
            }
            
        }
        function buscar() {
            var nome = $("#nomeBusca").val();
            var data = {
                Nome: nome,
            };
            if (nome.length > 3) {
                $.getJSON('/Usuario/BuscarPorNome',data, function (result) {
                    if (result != "" && result != null) {
                        PreencherTabela(result);
                    }
                    else {
                        txt = "";
                        $("#tbody").html("");
                        txt = "<tr><th>Nada Encontrado...</th></tr>";
                        $("#tbody").html(txt);
                    }
                });
            }
            return;
        }
        function PreencherTabela(data) {
            $("#tbody").html("");
            txt = "";
            if (data != null && data != "") {
                for (var i = 0; i < data.length; i++) {
                    if (data[i].observacoes == null) {
                        data[i].observacoes = "Sem observações.";
                    }
                    txt += "<tr class='col-12'>" +
                                "<th scope='col' class='col-12'>" +
                                    "<div class='card'>" +
                                        "<h5 class='mb-0'>" +
                                            "<button class='btn disabled btn-light' type='button' data-toggle='collapse' data-target='#id" + data[i].id + "' aria-expanded='false' aria-controls='#id" + data[i].id + "'>" + data[i].nome + "</button>" +
                                            "<button class='btn float-right'  type='button' data-toggle='collapse' data-target='#id" + data[i].id + "' aria-expanded='false' aria-controls='#id" + data[i].id + "'>" +
                                                "<i class='fas fa-angle-down'></i> " +
                                            "</button>" +
                                            "<a href='/Usuario/Index/" + data[i].cpf +"' class='btn float-right'>"+
                                                "<i class='far fa-edit'></i>" +
                                            "</a>" +
                                            "<button class='btn float-right' onclick='javascript: confirmaExcluir(" + data[i].id + ");'>" +
                                                "<i class='fas fa-trash-alt' ></i > "+
                                            "</button>" +
                                            
                                        "</h5>" +
                                        "<div class='collapse' id='id"+ data[i].id + "'>" +
                                            "<div class='card card-body'>" +
                                                "<spam>Telefone: </spam><small class='text-muted'>" + data[i].telefone + "</small><br>" +
                                                "<spam>E-mail: </spam><small class='text-muted'>" + data[i].email + "</small><br>" +
                                                "<spam>Observações: </spam><small class='text-muted'>" + data[i].observacoes + "</small><br>" +
                                                "<a href='/Usuario/GerenciarTempoSocio/" + data[i].id +"'><spam class='text-danger'>Gerenciar Tempo de Sociedade </spam></a><br>" +
                                            "</div>" +
                                        "</div>" +
                                    "</div>" +
                                "</th>" +
                            "</tr>";
                    
                }
            }
            $("#tbody").html(txt);
            
        }
        function confirmaExcluir(id) {
           
            var botoes = '<button type="button" class="btn btn-dark txt-branco" data-dismiss="modal">Cancelar</button><button type="button" class="btn btn-light vermelho txt-branco" onclick="javascript: excluir('+id+');" data-dismiss="modal">Excluir</button>';
            $("#botao").html(botoes);
            $('#Erro').modal('show');
        }
        function excluir(id) {
            $("#carregando").html('<i class="fas fa-spinner fa-spin">');
            $.ajax({
                type: 'POST',
                url: '/Usuario/Excluir',
                data: { id },
                success: function (data) {
                    if (data > 0) {
                        $('.alert').alert()
                        $.getJSON("/Usuario/BuscarUsuarios", function (data) {
                            PreencherTabela(data);
                            $("#carregando").html('');
                        });
                    }
                    if (data == -10) {
                        $('#Erro').modal('show');
                        $('#titulo').html("Ops... Ocorreu um erro!");
                        $('#corpo').html("Tente novamente mais tarde.");
                        var botoes = '<button type="button" class="btn btn-dark txt-branco" data-dismiss="modal">Cancelar</button>';
                        $("#botao").html(botoes);
                        $("#carregando").html('');
                    }
                },
                error: function (data) {
                    $('#Erro').modal('show');
                    $('#titulo').html("Ops... Ocorreu um erro!");
                    $('#corpo').html("Tente novamente mais tarde.");
                    var botoes = '<button type="button" class="btn btn-dark txt-branco" data-dismiss="modal">Cancelar</button>';
                    $("#botao").html(botoes);
                    $("#carregando").html('');
                }
            });
        }
    </script>
    @*aria-labelledby="headingOne" data-parent="'+data[i].id+'"*@
}
<div class="container my-5">
    <div class="row">
        <div class="col-lg-1 col-12" align="center">
            <span> <img src="~/images/icones-sistema/Listar.png" class="logo" alt="Imagem de 3 pessoas uma ao lado da outra simbolizando uma sociedade" /></span>
        </div>
        <div class="col-lg-6 col-12 align-self-center float-none">
            <h2> Usuarios Cadastrados </h2> <span id="carregando"></span>
        </div>
        
    </div>
</div>

<div class="container">
    <table class="table">
        <thead>
            <tr scope="col" class="col-12">
                <th>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control col-12" placeholder="Pesquise um Usuário" onkeydown="javascript: buscar();" id="nomeBusca" />
                    </div>
                </th>
            </tr>
            <tr scope="col" class="col-12">
                <th>
                    <div class="input-group mb-3">
                      
                        <select class="form-control jogador" onchange="javascript: SelectBuscar();" id="busca">
                            <option value="0">---Tipo de Buscas---</option>
                            <option value="1">Todos os usuários</option>
                            <option value="2">Buscar todos os Socios</option>
                            <option value="3">Buscar todos os Jogadores</option>
                        </select>
                        <div class="valid-feedback" id="valida-jogador-valid">
                        </div>
                    </div>
                </th>
            </tr>
        </thead>
        <tbody id="tbody">
           <tr>
               <td>
                   <p class="h6"><i class="fas fa-spinner fa-spin"></i> Pesquisando Usuarios...</p>
               </td>
           </tr>
        </tbody>
    </table>

</div>

<div class="modal" id="Erro" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titulo">Deseja excluir este usuário?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="corpo">
                Este usuário será excluido permanentemente!
            </div>
            <div class="modal-footer" id="botao">
                
            </div>
        </div>
    </div>
</div>
