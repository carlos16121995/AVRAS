
@{
    ViewData["Title"] = "Lista";
    Layout = "~/Views/Shared/_Layout_Painel.cshtml";
}
@section script {
    <script>
        $(document).ready(function () {
            $.getJSON("/Patrocinador/BuscarPatrocinadores", function (data) {
                PreencherTabela(data);

            });
        });
        function buscar() {
            var nome = $("#nomeBusca").val();
            var data = {
                Nome: nome,
            };
            if (nome.length > 3) {
                $.getJSON('/Patrocinador/BuscarPorNome',data, function (result) {
                    if (result != "" && result != null) {
                        PreencherTabela(result);
                    }
                    else {
                        txt = "";
                        $("#tbody").html("");
                        txt = "<tr><th>Nada Encontrado...</th></tr>";
                        $("#tbody").html(txt);
                    }
                });
            }
            return;
        }
        function FormatarDataInglesParaPadrao(date) {
            var data = date.split("-");
            var dia = data[2].substr(0,2);
            var mes = data[1];
            var ano = data[0];

            data = dia + "/" + mes + "/" + ano;

            return data;
        }
        function PreencherTabela(data) {
            $("#tbody").html("");
            txt = "";
            if (data != null && data != "") {
                for (var i = 0; i < data.length; i++) {
                    if (data[i].observacoes == null) {
                        data[i].observacoes = "Sem observações.";
                    }
                    txt += "<tr class='col-12'>" +
                                "<th scope='col' class='col-12'>" +
                                    "<div class='card'>" +
                                        "<h5 class='mb-0'>" +
                                            "<button class='btn disabled btn-light' type='button' data-toggle='collapse' data-target='#id" + data[i].id + "' aria-expanded='false' aria-controls='#id" + data[i].id + "'>" + data[i].nome + "</button>" +
                                            "<button class='btn float-right'  type='button' data-toggle='collapse' data-target='#id" + data[i].id + "' aria-expanded='false' aria-controls='#id" + data[i].id + "'>" +
                                                "<i class='fas fa-angle-down'></i> " +
                                            "</button>" +
                                            "<a href='/Patrocinador/Cadastro/" + data[i].id +"' class='btn float-right'>"+
                                                "<i class='far fa-edit'></i>" +
                                            "</a>" +
                                            "<button class='btn float-right' onclick='javascript: confirmaExcluir(" + data[i].id + ");'>" +
                                                "<i class='fas fa-trash-alt' ></i > "+
                                            "</button>" +

                                        "</h5>" +
                                        "<div class='collapse' id='id"+ data[i].id + "'>" +
                                            "<div class='card card-body'>" +
                        "<spam>Vencimento do Contrato: </spam><small class='text-muted'>" + FormatarDataInglesParaPadrao(data[i].dataVencimento) + "</small><br>" +
                                            "<spam>Valor Contrato: </spam><small class='text-muted'>R$ " + (data[i].valor).toLocaleString('pt-BR') + "</small><br>" +
                                                "<spam>Quantidade de Parcelas: </spam><small class='text-muted'>" + data[i].parcelas + "</small><br>" +
                                            "</div>" +
                                        "</div>" +
                                    "</div>" +
                                "</th>" +
                            "</tr>";

                }
            }
            $("#tbody").html(txt);

        }
        function confirmaExcluir(id) {

            var botoes = '<button type="button" class="btn btn-dark txt-branco" data-dismiss="modal">Cancelar</button><button type="button" class="btn btn-light vermelho txt-branco" onclick="javascript: excluir('+id+');" data-dismiss="modal">Excluir</button>';
            $("#botao").html(botoes);
            $('#Erro').modal('show');
        }
        function excluir(id) {
            $("#carregando").html('<i class="fas fa-spinner fa-spin">');
            $.ajax({
                type: 'POST',
                url: '/Patrocinador/Excluir',
                data: { id },
                success: function (data) {
                    if (data > 0) {
                        $('.alert').alert()
                        $.getJSON("/Patrocinador/BuscarPatrocinadores", function (data) {
                            PreencherTabela(data);
                            $("#carregando").html('');
                        });
                    }
                    if (data == -10) {
                        $('#Erro').modal('show');
                        $('#titulo').html("Ops... Ocorreu um erro!");
                        $('#corpo').html("Tente novamente mais tarde.");
                        var botoes = '<button type="button" class="btn btn-dark txt-branco" data-dismiss="modal">Cancelar</button>';
                        $("#botao").html(botoes);
                        $("#carregando").html('');
                    }
                },
                error: function (data) {
                    $('#Erro').modal('show');
                    $('#titulo').html("Ops... Ocorreu um erro!");
                    $('#corpo').html("Tente novamente mais tarde.");
                    var botoes = '<button type="button" class="btn btn-dark txt-branco" data-dismiss="modal">Cancelar</button>';
                    $("#botao").html(botoes);
                    $("#carregando").html('');
                }
            });
        }
    </script>
    @*aria-labelledby="headingOne" data-parent="'+data[i].id+'"*@
}
<div class="container my-5">
    <div class="row">
        <div class="col-lg-1 col-12" align="center">
            <span> <img src="~/images/socio.png" class="logo" alt="Imagem de 3 pessoas uma ao lado da outra simbolizando uma sociedade" /></span>
        </div>
        <div class="col-lg-6 col-12 align-self-center float-none">
            <h2> Patrocinadores Cadastrados </h2> <span id="carregando"></span>
        </div>

    </div>
</div>

<div class="container">
    <table class="table">
        <thead>
            <tr scope="col" class="col-12">
                <th>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control col-12" placeholder="Pesquise um Patrocinador" onkeydown="javascript: buscar();" id="nomeBusca" />
                    </div>
                </th>
            </tr>
        </thead>
        <tbody id="tbody">
            <tr>
                <td>
                    <p class="h6"><i class="fas fa-spinner fa-spin"></i> Pesquisando Patrocinadores...</p>
                </td>
            </tr>
        </tbody>
    </table>

</div>

<div class="modal" id="Erro" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titulo">Deseja excluir este patrocinador?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="corpo">
                Este patrocinador será excluido permanentemente!
            </div>
            <div class="modal-footer" id="botao">

            </div>
        </div>
    </div>
</div>
